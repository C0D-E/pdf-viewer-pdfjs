<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PDF.js Viewer (GitHub Pages)</title>
  <style>
    html, body { height: 100%; margin: 0; padding: 0; }
    #controls { padding: 10px; background: #f8f8f8; border-bottom: 1px solid #ddd; }
    #pdf-viewer { width: 100vw; height: calc(100vh - 50px); overflow: auto; background: #eee; }
    canvas { display: block; margin: 0 auto; }
  </style>
</head>
<body>
  <div id="controls">
    <input type="file" id="file-input" accept="application/pdf" />
    <input type="text" id="url-input" placeholder="Paste PDF URL here" style="width: 300px;" />
    <button id="load-url">Load from URL</button>
  </div>
  <div id="pdf-viewer"></div>
  <!-- PDF.js from CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.2.67/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.2.67/pdf.worker.min.js"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.2.67/pdf.worker.min.js';

    function renderPDF(pdf) {
      const viewer = document.getElementById('pdf-viewer');
      viewer.innerHTML = '';
      // Render pages sequentially to avoid race conditions
      function renderPage(pageNum) {
        if (pageNum > pdf.numPages) return;
        pdf.getPage(pageNum).then(function(page) {
          const viewport = page.getViewport({ scale: 1.5 });
          const canvas = document.createElement('canvas');
          canvas.width = viewport.width;
          canvas.height = viewport.height;
          viewer.appendChild(canvas);
          page.render({ canvasContext: canvas.getContext('2d'), viewport: viewport }).promise.then(function() {
            renderPage(pageNum + 1);
          });
        });
      }
      renderPage(1);
    }

    function loadPDFfromArrayBuffer(arrayBuffer) {
      pdfjsLib.getDocument({ data: new Uint8Array(arrayBuffer) }).promise
        .then(renderPDF)
        .catch(err => alert('Error rendering PDF: ' + err.message));
    }

    function loadPDFfromURL(url) {
      pdfjsLib.getDocument(url).promise
        .then(renderPDF)
        .catch(err => alert('Error loading PDF: ' + err.message));
    }

    document.getElementById('file-input').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(ev) {
        loadPDFfromArrayBuffer(ev.target.result);
      };
      reader.readAsArrayBuffer(file);
    });

    document.getElementById('load-url').addEventListener('click', function() {
      const url = document.getElementById('url-input').value.trim();
      if (url) loadPDFfromURL(url);
    });
  </script>
</body>
</html>
